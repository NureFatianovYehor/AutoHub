<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AutoHub – Додати авто</title>
  <!-- Підключаємо основний стиль (style.css) та додатковий для форми (add.css) -->
  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" href="add.css" />
</head>
<body>
  <!-- Темна шапка (скопійована з index.html) -->
  <header class="header">
    <div class="header__container">
      <a href="/" class="header__logo">AutoHub</a>
      <nav class="header__nav">
        <a href="/" class="header__link">Головна</a>
        <a href="/add.html" class="header__link">Додати авто</a>
        <a href="/contacts.html" class="header__link">Контакти</a>
      </nav>
    </div>
  </header>

  <!-- Сторінка з формою -->
  <div class="form-page">
    <div class="form-container">
      <h2>Додати новий автомобіль</h2>

      <!-- Місце для повідомлень про помилку/успіх -->
      <div id="form-message" class="form-message" style="display: none;"></div>

      <form id="add-car-form">
        <!-- Назва та Опис -->
        <div class="form-group">
          <label for="title">Назва (коротко):</label>
          <input type="text" id="title" name="title" placeholder="Напр.: BMW 320i" required />
        </div>

        <div class="form-group">
          <label for="description">Опис:</label>
          <textarea id="description" name="description" placeholder="Надайте короткий опис автомобіля" required></textarea>
        </div>

        <!-- Марка та Модель у рядку -->
        <div class="form-row">
          <div class="form-group">
            <label for="brand">Марка:</label>
            <input type="text" id="brand" name="brand" placeholder="Напр.: BMW" required />
          </div>
          <div class="form-group">
            <label for="model">Модель:</label>
            <input type="text" id="model" name="model" placeholder="Напр.: 320i" required />
          </div>
        </div>

        <!-- Рік та Ціна у рядку -->
        <div class="form-row">
          <div class="form-group">
            <label for="year">Рік:</label>
            <input type="number" id="year" name="year" min="1900" max="2099" step="1" placeholder="2020" required />
          </div>
          <div class="form-group">
            <label for="price">Ціна (USD):</label>
            <input type="number" id="price" name="price" min="0" placeholder="25000" required />
          </div>
        </div>

        <!-- Пробіг та Тип палива у рядку -->
        <div class="form-row">
          <div class="form-group">
            <label for="mileage">Пробіг (км):</label>
            <input type="number" id="mileage" name="mileage" min="0" placeholder="50000" required />
          </div>
          <div class="form-group">
            <label for="fuel_type">Тип палива:</label>
            <input type="text" id="fuel_type" name="fuel_type" placeholder="Напр.: бензин, дизель" required />
          </div>
        </div>

        <!-- Коробка передач -->
        <div class="form-group">
          <label for="transmission">Коробка передач:</label>
          <input type="text" id="transmission" name="transmission" placeholder="Напр.: автомат, механіка" required />
        </div>

        <!-- Посилання на фото -->
        <div class="form-group">
          <label for="images">Посилання на фото (через кому):</label>
          <input type="text" id="images" name="images" placeholder="https://…jpg,https://…jpg" required />
        </div>

        <!-- Кнопка відправки -->
        <button type="submit" class="btn-submit">Додати в базу</button>
      </form>

      <!-- Посилання назад на головну (або каталог) -->
      <a href="/" class="back-link">Повернутися на головну</a>
    </div>
  </div>

  <!-- Підключаємо скрипт, який відправлятиме дані форми на бекенд -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const form = document.getElementById('add-car-form');
      const messageBox = document.getElementById('form-message');

      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        messageBox.style.display = 'none';
        messageBox.textContent = '';

        // Збираємо дані з форми
        const title = form.title.value.trim();
        const description = form.description.value.trim();
        const brand = form.brand.value.trim();
        const model = form.model.value.trim();
        const year = Number(form.year.value);
        const price = parseFloat(form.price.value);
        const mileage = parseInt(form.mileage.value, 10);
        const fuel_type = form.fuel_type.value.trim();
        const transmission = form.transmission.value.trim();
        const imagesInput = form.images.value
          .split(',')
          .map(url => url.trim())
          .filter(url => url !== '');

        // Простейка валідація (додайте більш сувору, якщо потрібно)
        if (!title || !description || !brand || !model || isNaN(year) || isNaN(price) || isNaN(mileage) || !fuel_type || !transmission || imagesInput.length === 0) {
          messageBox.textContent = 'Будь ласка, заповніть усі поля коректно.';
          messageBox.style.color = '#d32f2f';
          messageBox.style.display = 'block';
          return;
        }

        const carData = { title, description, brand, model, year, price, mileage, fuel_type, transmission, images: imagesInput };

        try {
          const res = await fetch('/cars', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(carData)
          });

          const result = await res.json();

          if (!res.ok) {
            throw new Error(result.error || 'Невідома помилка');
          }

          // Якщо успішно додано у Supabase, показуємо повідомлення (і чистимо форму)
          messageBox.textContent = 'Автомобіль успішно додано до бази!';
          messageBox.style.color = '#2e7d32'; /* зелений для успіху */
          messageBox.style.display = 'block';

          form.reset();
        } catch (err) {
          console.error(err);
          messageBox.textContent = `Помилка при додаванні: ${err.message}`;
          messageBox.style.color = '#d32f2f'; /* червоний для помилки */
          messageBox.style.display = 'block';
        }
      });
    });
  </script>
</body>
</html>
